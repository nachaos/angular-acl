"use strict";angular.module("mm.acl",[]),angular.module("mm.acl").provider("AclService",[function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(a){for(var b=this.length;b--;)if(this[b]===a)return b;return-1});var a={storage:"sessionStorage",storageKey:"AclService"},b={roles:[],abilities:{}},c=function(a){return"object"==typeof b.abilities[a]},d=function(a){return c(a)?b.abilities[a]:[]},e=function(){switch(a.storage){case"sessionStorage":f("sessionStorage");break;case"localStorage":f("localStorage");break;default:return}},f=function(c){window[c].setItem(a.storageKey,JSON.stringify(b))},g=function(b){var c=window[b].getItem(a.storageKey);return c?JSON.parse(c):!1},h={};return h.resume=function(){var c;switch(a.storage){case"sessionStorage":c=g("sessionStorage");break;case"localStorage":c=g("localStorage");break;default:c=null}return c?(angular.extend(b,c),!0):!1},h.attachRole=function(a){-1===b.roles.indexOf(a)&&(b.roles.push(a),e())},h.detachRole=function(a){var c=b.roles.indexOf(a);c>-1&&(b.roles.splice(c,1),e())},h.flushRoles=function(){b.roles=[],e()},h.hasRole=function(a){return b.roles.indexOf(a)>-1},h.getRoles=function(){return b.roles},h.setAbilities=function(a){b.abilities=a,e()},h.addAbility=function(a,c){b.abilities[a]||(b.abilities[a]=[]),b.abilities[a].push(c),e()},h.can=function(a){for(var c,e,f=b.roles.length;f--;)if(c=b.roles[f],e=d(c),e.indexOf(a)>-1)return!0;return!1},{config:function(b){angular.extend(a,b)},$get:function(){return h}}}]);